# Find users who logged in on at least 3 consecutive days from logins table.

```sql


-- Find users who logged in on at least 3 consecutive days from logins table.

-- create table
CREATE TABLE LOGINS (
  id INTEGER PRIMARY KEY,
  userName TEXT NOT NULL,
  loginDate DATE NOT NULL
);

-- insert sample data
INSERT INTO LOGINS VALUES (1, 'Clark',  '2025-01-01');
INSERT INTO LOGINS VALUES (2, 'Clark',  '2025-01-02');
INSERT INTO LOGINS VALUES (3, 'Clark',  '2025-01-03'); -- ✅ 3 consecutive days
INSERT INTO LOGINS VALUES (4, 'Clark',  '2025-01-05'); -- break

INSERT INTO LOGINS VALUES (5, 'Dave',   '2025-01-10');
INSERT INTO LOGINS VALUES (6, 'Dave',   '2025-01-12');
INSERT INTO LOGINS VALUES (7, 'Dave',   '2025-01-13'); -- not consecutive (gap)

INSERT INTO LOGINS VALUES (8, 'Ava',    '2025-02-01');
INSERT INTO LOGINS VALUES (9, 'Ava',    '2025-02-02');
INSERT INTO LOGINS VALUES (10, 'Ava',   '2025-02-03');
INSERT INTO LOGINS VALUES (11, 'Ava',   '2025-02-04'); -- ✅ 4 consecutive days

INSERT INTO LOGINS VALUES (12, 'Champa','2025-03-05'); -- only one login



select * from LOGINS;


-- ✅ Query (using window functions)

WITH cte AS (
    SELECT 
        userName,
        loginDate,
        ROW_NUMBER() OVER (PARTITION BY userName ORDER BY loginDate) AS rn
    FROM LOGINS
)
SELECT DISTINCT userName
FROM cte
GROUP BY userName, DATE_SUB(loginDate, INTERVAL rn DAY)
HAVING COUNT(*) >= 3;


--  a version without window functions (plain self-joins, works in older MariaDB/MySQL)

SELECT DISTINCT l1.userName
FROM LOGINS l1
JOIN LOGINS l2 
  ON l1.userName = l2.userName 
 AND DATEDIFF(l2.loginDate, l1.loginDate) = 1
JOIN LOGINS l3 
  ON l1.userName = l3.userName 
 AND DATEDIFF(l3.loginDate, l2.loginDate) = 1;
 
 
-- ✅ Generalized Query for N consecutive days

-- change N to whatever you want
SET @N := 3;

SELECT DISTINCT l1.userName
FROM LOGINS l1
JOIN LOGINS l2 
  ON l1.userName = l2.userName
 AND DATEDIFF(l2.loginDate, l1.loginDate) BETWEEN 1 AND @N-1
-- group consecutive streaks
GROUP BY l1.userName, l1.loginDate
HAVING COUNT(DISTINCT l2.loginDate) >= @N-1;





```