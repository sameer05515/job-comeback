# Write a query to remove duplicate rows but keep the first occurrence in a table with no unique key.


```sql

-- Write a query to remove duplicate rows but keep the first occurrence in a table with no unique key.

CREATE TABLE dup_users (
  id INT,
  name VARCHAR(50),
  email VARCHAR(50)
);

INSERT INTO dup_users VALUES
(1, 'Clark', 'clark@gmail.com'),
(2, 'Clark', 'clark@gmail.com'),
(3, 'Ava', 'ava@gmail.com'),
(4, 'Ava', 'ava@gmail.com'),
(5, 'Dave', 'dave@gmail.com');


select * from dup_users;


-- Delete duplicates (keep lowest id for each name+email)
DELETE u1 
FROM dup_users u1
JOIN dup_users u2
  ON u1.name = u2.name
 AND u1.email = u2.email
 AND u1.id > u2.id;


select * from dup_users;


-- 👍 Here’s the ROW_NUMBER() version (works in MySQL 8.0+ and MariaDB 10.2+ with window functions)

WITH ranked AS (
  SELECT 
    id, 
    name, 
    email,
    ROW_NUMBER() OVER (PARTITION BY name, email ORDER BY id) AS rn
  FROM dup_users
)
DELETE FROM dup_users
WHERE id IN (
  SELECT id FROM ranked WHERE rn > 1
);


```



```
Output:

+------+-------+-----------------+
| id   | name  | email           |
+------+-------+-----------------+
|    1 | Clark | clark@gmail.com |
|    2 | Clark | clark@gmail.com |
|    3 | Ava   | ava@gmail.com   |
|    4 | Ava   | ava@gmail.com   |
|    5 | Dave  | dave@gmail.com  |
+------+-------+-----------------+
+------+-------+-----------------+
| id   | name  | email           |
+------+-------+-----------------+
|    1 | Clark | clark@gmail.com |
|    3 | Ava   | ava@gmail.com   |
|    5 | Dave  | dave@gmail.com  |
+------+-------+-----------------+

```